var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var M=(e,n,t)=>n in e?Q(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,i=(e,n)=>{for(var t in n||(n={}))F.call(n,t)&&M(e,t,n[t]);if(j)for(var t of j(n))P.call(n,t)&&M(e,t,n[t]);return e},f=(e,n)=>W(e,X(n));var S=(e,n)=>{var t={};for(var a in e)F.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&j)for(var a of j(e))n.indexOf(a)<0&&P.call(e,a)&&(t[a]=e[a]);return t};import{q as Y,r as ee,s as R,t as te,u as C,F as ne,v as oe,m as I,a as T,T as ae,d as se,w as O,E as re,x as D,y as ie,z as ce,B as ue,D as le,G as de,H as me,J as z,K as fe,L as pe,N as be,c as we,O as ye,P as he}from"./index.716b61fb.js";import"./vendor.1045acf8.js";import{b as B,a as _,O as ge,Z as ve,h as N,j as Ie,_ as je,d as Ee}from"./hoc.faed4dd2.js";import{j as u,a as $,F as xe}from"./index.2e39aa0a.js";import"./1d4eb3kqu.cb22cad3.js";import"./index.ab4c0410.js";import"https://static-s.gaiaworkforce.com/formPlatForm/umdjs/monaco/index.min.js";import"https://wizui-assets.oss-cn-hangzhou.aliyuncs.com/umd/arco.min.js";import"https://unpkg.com/react-dnd@14.0.5/dist/umd/ReactDnD.min.js";import"https://unpkg.com/react-dnd-html5-backend@14.0.2/dist/umd/ReactDnDHTML5Backend.min.js";import"https://unpkg.com/@arco-design/web-react@2.55.0/dist/arco.min.js";import"https://unpkg.com/@arco-design/web-react@2.55.0/dist/arco-icon.min.js";var Se=e=>u(Y,i({placeholder:"\u8BF7\u8F93\u5165",autoComplete:"off"},e));const Ce=e=>B.post("/apijson/get",{"Module[]":{count:0,Module:{"id{}":e,platform:_.platform,deletedTime:0,appId:_.appId,"@column":"id,moduleId,name,imgUrl,nickname,description,deletedTime,category,display,content,extraInfo,jsxRender,platform,price,manufacturer,props,source"}}}).then(n=>{const t=n.Module.map(ee);for(const a of t)a.source=="custom"&&a.extraInfo&&a.extraInfo.cssStr&&ge(a.extraInfo.cssStr,a.moduleId);return t});function A(e,n,t){return n=ke(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ke(e){var n=Fe(e,"string");return typeof n=="symbol"?n:String(n)}function Fe(e,n){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var a=t.call(e,n||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}class Pe{constructor(){A(this,"value",[]),A(this,"setValue",n=>{this.value=n})}}const Me=window.React.useEffect,Re=window.React.useMemo,K=window.React.useState,Te=window.arco.Table,Oe=window.arco.Checkbox,De=window.arco.InputNumber,E=window.arco.Button,ze=window.arco.Input,Be=window.arco.Space,_e=window.arcoicon.IconArrowDown,Ne=window.arcoicon.IconArrowUp,$e=window.arcoicon.IconDelete,Ae=window.arcoicon.IconPlus,Ke=a=>{var l=a,{notOperation:e,notAdd:n}=l,t=S(l,["notOperation","notAdd"]);const[o]=K(()=>typeof t.rowKey=="string"?t.rowKey:"id"),[s]=K(()=>new Pe),y=t.value||[];Me(()=>{Array.isArray(t.value)&&!Object.is(s.value,t.value)?s.setValue(t.value.map(b=>i({[o]:Math.random().toString(32).slice(2)},b))):s.setValue([])},[t.value]);const h=b=>{const c=t.columns.find(r=>r.valueType==="index"||r.valueType==="letter"),m=b.map((r,d)=>c?f(i({},r),{[c.dataIndex]:c.valueType==="index"?d:ve[d]}):i({},r));t.value||s.setValue(m),t.onChange&&t.onChange(m)},g=(b,c)=>{const m=[...s.value];m[b]=c,h(m)},Z=Re(()=>{if(!t.columns)return[];const b=[...t.columns.map((c,m)=>(!c.render&&c.valueType!=="text"&&(c.render=(r,d,v)=>{switch(c.valueType){case"index":case"letter":return r;case"any":return u(te,{value:r,onChange:p=>g(v,f(i({},d),{[c.dataIndex]:p}))},d[o]);case"checkout":return u(Oe,{checked:r,onChange:p=>g(v,f(i({},d),{[c.dataIndex]:p}))},d[o]);case"number":return u(De,{placeholder:"\u8BF7\u8F93\u5165",value:r,onChange:p=>g(v,f(i({},d),{[c.dataIndex]:p}))},d[o]);case"color":return u(R,{value:r,onChange:p=>{g(v,f(i({},d),{[c.dataIndex]:p}))}},d[o]);default:return u(ze,{placeholder:"\u8BF7\u8F93\u5165",value:r,onChange:p=>g(v,f(i({},d),{[c.dataIndex]:p}))},d[o])}}),c))];return e||b.push({title:"\u64CD\u4F5C",dataIndex:o,width:60,render:(c,m,r)=>$(Be,{size:"mini",children:[u(E,{size:"mini",shape:"circle",status:"danger",type:"primary",icon:u($e,{}),onClick:()=>{h(s.value.filter(d=>d[o]!==m[o]))}}),Boolean(r)?u(E,{size:"mini",shape:"circle",type:"primary",icon:u(Ne,{}),onClick:()=>{s.value.splice(r,1),s.value.splice(r-1,0,m),h([...s.value])}}):u(E,{size:"mini",shape:"circle",type:"primary",icon:u(_e,{}),onClick:()=>{s.value.splice(r,1),s.value.splice(r+1,0,m),h([...s.value])}})]})}),b},[t.columns]);return $(xe,{children:[u(Te,f(i({className:"editor-table",pagination:!1,rowKey:o},t),{data:y,onChange:void 0,columns:Z})),!n&&u(E,{type:"outline",style:{width:"100%",marginTop:8},icon:u(Ae,{}),onClick:()=>g(s.value.length,{[o]:Math.random().toString(32).slice(2)}),children:"\u6DFB\u52A0"})]})};var w,V,L;function J(e,n,t,a){!t||Object.defineProperty(e,n,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(a):void 0})}function G(e,n,t){return n=Ve(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Ve(e){var n=Le(e,"string");return typeof n=="symbol"?n:String(n)}function Le(e,n){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var a=t.call(e,n||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function k(e,n,t,a,l){var o={};return Object.keys(a).forEach(function(s){o[s]=a[s]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(s,y){return y(e,n,s)||s},o),l&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(l):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,n,o),o=null),o}const Je=window.mobx.action,Ge=window.mobx.observable,Ue=window.mobx.computed,qe=window.mobx.toJS;let He=(w=class{constructor(){J(this,"values",V,this),J(this,"setValues",L,this),G(this,"init",async n=>{const{tableId:t,modelKey:a,itemId:l}=n;if(C.info[t]){this.setValues(f(i({},C.info[t]),{modelKey:a,itemId:l}));return}const o=await N.ajax.get("/custom/table/fields",{customTableInfoId:t}),s=await N.ajax.get("/custom/relation/itemTable",{tableId:t});C.setInfo(t,{fields:o,tables:s}),this.setValues({fields:o,tables:s,modelKey:a,itemId:l})}),G(this,"unInit",()=>{this.setValues({})})}get businessObj(){return qe(this.values)}},V=k(w.prototype,"values",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),L=k(w.prototype,"setValues",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e=>{this.values=e}}}),k(w.prototype,"businessObj",[Ue],Object.getOwnPropertyDescriptor(w.prototype,"businessObj"),w.prototype),w);const Ze=window.React.useEffect,U=window.React.useState,Qe=window.mobxReactLite.useObserver;var We=({value:e,children:n})=>{const[t]=U(()=>new He),[a]=U(()=>ReactGtssForm.config.state.contexts.system_business);return Ze(()=>{const{tableId:l,modelKey:o}=e||{};l?t.init(e):t.unInit()},[e==null?void 0:e.tableId]),Qe(()=>u(a.Provider,{value:e,children:u(ne.Provider,{value:t.businessObj,children:n})}))};const x=window.React,q=window.React.createElement,Xe=window.arco.Switch,Ye=window.arco.Modal,H=window.ReactGtssForm||{config:Ee};oe({parse:!0,parseConfig:{saveCustomModule:async e=>{const n=e.map(t=>{const a=I.elements.get(t.uid);return a.nickname||a.name}).join(",");return new Promise((t,a)=>{Ye.confirm({title:"\u66F4\u65B0\u7EC4\u4EF6",content:`\u60A8\u4FEE\u6539\u4E86${n}\u7EC4\u4EF6\u4FE1\u606F\uFF0C\u8BF7\u786E\u8BA4\u662F\u5426\u4FDD\u5B58`,onCancel:a,onOk:async()=>{const l=e.slice().reverse();for(const o of l){const s=o.getData(),y={props:s.page.props,content:s,jsxRender:await o.getRenderText()},h=I.elements.get(o.uid);await B.post("/apijson/put",{Module:f(i({id:o.uid},y),{content:JSON.stringify(s)})}).then(()=>{I.updateElement(o.uid,i(i({},h),y))})}t(!0)}})})}},schema:{formats:{boolean:e=>q(Xe,i({checked:e.value},e)),selector:T,treeSelector:ae,featch:se,lookup:e=>q(T,i({type:"lookup"},e)),icon:O,image:re,iconText:O,function:D,js:D,field:ie,itemTable:ce,style:ue,class:le,color:R,nodeInput:Se,editorTable:Ke,jsonSchema:de,json:me,jsonList:z,object:z.JSONEdit,schema:fe,node:pe,functionNode:be,modelKey:we},sources:{featch:{funName:"featchData"}},pageInjectedVars:["forms"]},modules:{getRender:e=>{const n=H.config,{key:t,source:a,name:l}=e;let o=()=>null;switch(a){case"arco":o=n.state.mModules[t]||(()=>t);break;case"custom":e.jsxRender&&(o=Ie(e.jsxRender)),n.state.mModules[e.key]=o;break;case"system":o=n.state.mModules[e.key];break;case"context":n.state.contexts[e.key]||(n.state.contexts[e.key]=x.createContext(e.extraInfo.defaultProps)),e.key==="system_business"?o=We:o=n.state.contexts[e.key].Provider,n.state.mModules[e.key]=o;break}return o&&o.preload&&o.preload(),o},getIcon:e=>x.createElement(je,{value:e,key:e})},api:{getModuleList:Ce},dependencies:{pandora:"pandora",arco:"arco-design/web-react"},run:H.config});I.setElements(ye);he.forEach(e=>{I.elements.set(e.key,i({render:n=>{const o=n,{children:t}=o,a=S(o,["children"]),l=x.Children.toArray(t);return x.createElement(e.key,a,...l)}},e))});

var H=Object.defineProperty,q=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var F=(e,n,t)=>n in e?H(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,l=(e,n)=>{for(var t in n||(n={}))C.call(n,t)&&F(e,t,n[t]);if(v)for(var t of v(n))P.call(n,t)&&F(e,t,n[t]);return e},p=(e,n)=>q(e,Y(n));var x=(e,n)=>{var t={};for(var a in e)C.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&v)for(var a of v(e))n.indexOf(a)<0&&P.call(e,a)&&(t[a]=e[a]);return t};import{q as Q,r as W,s as R,t as X,u as S,F as Z,v as ee,a as T,T as te,b as ne,w as oe,x as M,y as ae,z as re,B as se,D as ie,G as ce,H as ue,J as z,K as le,L as de,N as me,E as fe,m as O,O as pe,P as be}from"./index.d023d74a.js";import"./vendor.96977194.js";import{b as we,a as D,U as he,Y as ye,h as _,O as ge}from"./hoc.b0dff90e.js";import{j as c,a as B,F as ve}from"./index.bef7645d.js";import"./index.b87f432c.js";import"./10v74h69b.8daa2cb2.js";import"https://static-s.gaiaworkforce.com/formPlatForm/umdjs/monaco/index.min.js";import"https://wizui-assets.oss-cn-hangzhou.aliyuncs.com/umd/arco.min.js";import"https://unpkg.com/react-dnd@14.0.5/dist/umd/ReactDnD.min.js";import"https://unpkg.com/react-dnd-html5-backend@14.0.2/dist/umd/ReactDnDHTML5Backend.min.js";import"https://unpkg.com/@arco-design/web-react@2.55.0/dist/arco.min.js";import"https://unpkg.com/@arco-design/web-react@2.55.0/dist/arco-icon.min.js";var Ie=e=>c(Q,l({placeholder:"\u8BF7\u8F93\u5165",autoComplete:"off"},e));const je=e=>we.post("/apijson/get",{"Module[]":{count:0,Module:{"id{}":e,platform:D.platform,deletedTime:0,appId:D.appId,"@column":"id,moduleId,name,imgUrl,nickname,description,deletedTime,category,display,content,extraInfo,jsxRender,platform,price,manufacturer,props,source"}}}).then(n=>{const t=n.Module.map(W);for(const a of t)a.source=="custom"&&a.extraInfo&&a.extraInfo.cssStr&&he(a.extraInfo.cssStr,a.moduleId);return t});function N(e,n,t){return n=xe(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function xe(e){var n=Se(e,"string");return typeof n=="symbol"?n:String(n)}function Se(e,n){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var a=t.call(e,n||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}class ke{constructor(){N(this,"value",[]),N(this,"setValue",n=>{this.value=n})}}const Ee=window.React.useEffect,Ce=window.React.useMemo,K=window.React.useState,Pe=window.arco.Table,Fe=window.arco.Checkbox,Re=window.arco.InputNumber,I=window.arco.Button,Te=window.arco.Input,Me=window.arco.Space,ze=window.arcoicon.IconArrowDown,Oe=window.arcoicon.IconArrowUp,De=window.arcoicon.IconDelete,_e=window.arcoicon.IconPlus,Be=a=>{var d=a,{notOperation:e,notAdd:n}=d,t=x(d,["notOperation","notAdd"]);const[o]=K(()=>typeof t.rowKey=="string"?t.rowKey:"id"),[r]=K(()=>new ke),j=t.value||[];Ee(()=>{Array.isArray(t.value)&&!Object.is(r.value,t.value)?r.setValue(t.value.map(b=>l({[o]:Math.random().toString(32).slice(2)},b))):r.setValue([])},[t.value]);const g=b=>{const i=t.columns.find(s=>s.valueType==="index"||s.valueType==="letter"),m=b.map((s,u)=>i?p(l({},s),{[i.dataIndex]:i.valueType==="index"?u:ye[u]}):l({},s));t.value||r.setValue(m),t.onChange&&t.onChange(m)},h=(b,i)=>{const m=[...r.value];m[b]=i,g(m)},G=Ce(()=>{if(!t.columns)return[];const b=[...t.columns.map((i,m)=>(!i.render&&i.valueType!=="text"&&(i.render=(s,u,y)=>{switch(i.valueType){case"index":case"letter":return s;case"any":return c(X,{value:s,onChange:f=>h(y,p(l({},u),{[i.dataIndex]:f}))},u[o]);case"checkout":return c(Fe,{checked:s,onChange:f=>h(y,p(l({},u),{[i.dataIndex]:f}))},u[o]);case"number":return c(Re,{placeholder:"\u8BF7\u8F93\u5165",value:s,onChange:f=>h(y,p(l({},u),{[i.dataIndex]:f}))},u[o]);case"color":return c(R,{value:s,onChange:f=>{h(y,p(l({},u),{[i.dataIndex]:f}))}},u[o]);default:return c(Te,{placeholder:"\u8BF7\u8F93\u5165",value:s,onChange:f=>h(y,p(l({},u),{[i.dataIndex]:f}))},u[o])}}),i))];return e||b.push({title:"\u64CD\u4F5C",dataIndex:o,width:60,render:(i,m,s)=>B(Me,{size:"mini",children:[c(I,{size:"mini",shape:"circle",status:"danger",type:"primary",icon:c(De,{}),onClick:()=>{g(r.value.filter(u=>u[o]!==m[o]))}}),Boolean(s)?c(I,{size:"mini",shape:"circle",type:"primary",icon:c(Oe,{}),onClick:()=>{r.value.splice(s,1),r.value.splice(s-1,0,m),g([...r.value])}}):c(I,{size:"mini",shape:"circle",type:"primary",icon:c(ze,{}),onClick:()=>{r.value.splice(s,1),r.value.splice(s+1,0,m),g([...r.value])}})]})}),b},[t.columns]);return B(ve,{children:[c(Pe,p(l({className:"editor-table",pagination:!1,rowKey:o},t),{data:j,onChange:void 0,columns:G})),!n&&c(I,{type:"outline",style:{width:"100%",marginTop:8},icon:c(_e,{}),onClick:()=>h(r.value.length,{[o]:Math.random().toString(32).slice(2)}),children:"\u6DFB\u52A0"})]})};var w,L,V;function A(e,n,t,a){!t||Object.defineProperty(e,n,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(a):void 0})}function $(e,n,t){return n=Ne(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Ne(e){var n=Ke(e,"string");return typeof n=="symbol"?n:String(n)}function Ke(e,n){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var a=t.call(e,n||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function k(e,n,t,a,d){var o={};return Object.keys(a).forEach(function(r){o[r]=a[r]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(r,j){return j(e,n,r)||r},o),d&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(d):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,n,o),o=null),o}const Le=window.mobx.action,Ve=window.mobx.observable,Ae=window.mobx.computed,$e=window.mobx.toJS;let Ue=(w=class{constructor(){A(this,"values",L,this),A(this,"setValues",V,this),$(this,"init",async n=>{const{tableId:t,modelKey:a,itemId:d}=n;if(S.info[t]){this.setValues(p(l({},S.info[t]),{modelKey:a,itemId:d}));return}const o=await _.ajax.get("/custom/table/fields",{customTableInfoId:t}),r=await _.ajax.get("/custom/relation/itemTable",{tableId:t});S.setInfo(t,{fields:o,tables:r}),this.setValues({fields:o,tables:r,modelKey:a,itemId:d})}),$(this,"unInit",()=>{this.setValues({})})}get businessObj(){return $e(this.values)}},L=k(w.prototype,"values",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),V=k(w.prototype,"setValues",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return e=>{this.values=e}}}),k(w.prototype,"businessObj",[Ae],Object.getOwnPropertyDescriptor(w.prototype,"businessObj"),w.prototype),w);const Je=window.React.useEffect,U=window.React.useState,Ge=window.mobxReactLite.useObserver;var He=({value:e,children:n})=>{const[t]=U(()=>new Ue),[a]=U(()=>ReactGtssForm.config.state.contexts.system_business);return Je(()=>{const{tableId:d,modelKey:o}=e||{};d?t.init(e):t.unInit(),console.log("value",e)},[e==null?void 0:e.tableId]),Ge(()=>c(a.Provider,{value:e,children:c(Z.Provider,{value:t.businessObj,children:n})}))};const E=window.React,J=window.React.createElement,qe=window.arco.Switch;ee({typescriptURL:"https://static-s.gaiaworkforce.com/formPlatForm/umdjs/typescript.min.js",lessURL:"https://static-s.gaiaworkforce.com/formPlatForm/umdjs/less.min.js",schema:{formats:{boolean:e=>J(qe,l({checked:e.value},e)),selector:T,treeSelector:te,featch:ne,lookup:e=>J(T,l({type:"lookup"},e)),icon:oe,function:M,js:M,field:ae,itemTable:re,style:se,class:ie,color:R,nodeInput:Ie,editorTable:Be,jsonSchema:ce,json:ue,jsonList:z,object:z.JSONEdit,schema:le,node:de,functionNode:me,modelKey:fe},sources:{featch:{funName:"featchData"}},pageInjectedVars:["forms"]},modules:{getRender:e=>{const n=ReactGtssForm.config,{key:t,source:a,name:d}=e;let o=()=>null;switch(a){case"arco":o=n.state.mModules[t]||(()=>t);break;case"custom":e.jsxRender&&(o=ge(e.jsxRender)),n.state.mModules[e.key]=o;break;case"system":o=n.state.mModules[e.key];break;case"context":n.state.contexts[e.key]||(n.state.contexts[e.key]=E.createContext(e.extraInfo.defaultProps)),e.key==="system_business"?o=He:o=n.state.contexts[e.key].Provider,n.state.mModules[e.key]=o;break}return o&&o.preload&&o.preload(),o}},api:{getModuleList:je},dependencies:{pandora:"pandora",arco:"arco-design/web-react"},run:ReactGtssForm.config});O.setElements(pe);be.forEach(e=>{O.elements.set(e.key,l({render:n=>{const d=n,{children:t}=d,a=x(d,["children"]);return E.createElement(e.key,a,...E.Children.toArray(t))}},e))});

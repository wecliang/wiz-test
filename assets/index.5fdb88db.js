var ye=Object.defineProperty,ge=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var O=(t,e,i)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,y=(t,e)=>{for(var i in e||(e={}))k.call(e,i)&&O(t,i,e[i]);if(P)for(var i of P(e))N.call(e,i)&&O(t,i,e[i]);return t},I=(t,e)=>ge(t,ve(e));var V=(t,e)=>{var i={};for(var o in t)k.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(t!=null&&P)for(var o of P(t))e.indexOf(o)<0&&N.call(t,o)&&(i[o]=t[o]);return i};import{m as Ie,A as _e,e as xe,I as Fe,f as je}from"./index.4570827b.js";import{c as R}from"./index.b2d33ba3.js";import{O as Ee,T as Me,b as m,U as ze,a as j,q as K,e as De,g as Pe,V as Se,W as $e}from"./hoc.1518c0b9.js";import"./vendor.96977194.js";import{j as n,a as u}from"./index.77b54dbf.js";import"./___vite-browser-external_commonjs-proxy.579575e7.js";import"https://static-s.gaiaworkforce.com/formPlatForm/umdjs/monaco/index.min.js";import"https://wizui-assets.oss-cn-hangzhou.aliyuncs.com/umd/arco.min.js";import"https://unpkg.com/react-dnd@14.0.5/dist/umd/ReactDnD.min.js";import"https://unpkg.com/react-dnd-html5-backend@14.0.2/dist/umd/ReactDnDHTML5Backend.min.js";import"https://unpkg.com/@arco-design/web-react@2.55.0/dist/arco.min.js";import"https://unpkg.com/@arco-design/web-react@2.55.0/dist/arco-icon.min.js";const Ce="_pages_1b4lj_1",Be="_serach_1b4lj_5",Te="_resize_1b4lj_8",Ae="_listHeader_1b4lj_14",Le="_listBody_1b4lj_33",ke="_treeItem_1b4lj_39",Ne="_treeItemTitle_1b4lj_39",Oe="_titleText_1b4lj_48",Ve="_body_1b4lj_63",Re="_bodyList_1b4lj_69",Ke="_container_1b4lj_78",He="_content_1b4lj_82",Je="_contentScale_1b4lj_98";var p={pages:Ce,serach:Be,resize:Te,listHeader:Ae,listBody:Le,treeItem:ke,treeItemTitle:Ne,titleText:Oe,body:Ve,bodyList:Re,container:Ke,content:He,contentScale:Je},l,H,J,q,U,Y,G,W,Q,X,Z;function w(t,e,i,o){!i||Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function _(t,e,i){return e=qe(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function qe(t){var e=Ue(t,"string");return typeof e=="symbol"?e:String(e)}function Ue(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var o=i.call(t,e||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function b(t,e,i,o,s){var r={};return Object.keys(o).forEach(function(a){r[a]=o[a]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce(function(a,d){return d(t,e,a)||a},r),s&&r.initializer!==void 0&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),r.initializer===void 0&&(Object.defineProperty(t,e,r),r=null),r}const E=window.mobx.observable,M=window.mobx.action,Ye=window.mobx.computed,Ge=window.mobx.toJS;let We=(l=class{constructor(){_(this,"values",{}),_(this,"form",void 0),w(this,"visible",H,this),w(this,"setVisible",J,this),w(this,"copyVisible",q,this),w(this,"setCopyVisible",U,this),w(this,"select",Y,this),w(this,"onSelect",G,this),w(this,"expandedKeys",W,this),w(this,"setExpandedKeys",Q,this),_(this,"addExpandedKeys",e=>{this.setExpandedKeys([...this.expandedList,e.id])}),_(this,"saveExpandedKeys",e=>{this.expandedList.find(i=>i==e.id)?this.setExpandedKeys(this.expandedList.filter(i=>i!=e.id)):this.addExpandedKeys(e)}),_(this,"schema",{type:"object",title:"\u83DC\u5355",properties:{parentId:{type:"string",title:"\u4E0A\u7EA7\u83DC\u5355",colProps:{span:24},show:{type:"menu"},format:"treeSelector",fieldProps:{type:"menu"},default:null},name:{type:"string",title:"\u83DC\u5355\u540D\u79F0",maxLength:50,default:null},path:{type:"string",title:"\u8DEF\u7531\u5730\u5740",pattern:"^[0-9a-z]+$",maxLength:100,default:null}},required:["name","path"]}),_(this,"copySchema",{}),w(this,"search",X,this),w(this,"setSearch",Z,this)}get expandedList(){return Ge(this.expandedKeys)}},H=b(l.prototype,"visible",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),J=b(l.prototype,"setVisible",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(t,e={})=>{this.visible=t,this.values=e}}}),q=b(l.prototype,"copyVisible",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),U=b(l.prototype,"setCopyVisible",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(t,e={})=>{this.visible=t,this.values=e}}}),Y=b(l.prototype,"select",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),G=b(l.prototype,"onSelect",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t=>{this.select=t[0]}}}),W=b(l.prototype,"expandedKeys",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q=b(l.prototype,"setExpandedKeys",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t=>{this.expandedKeys=t}}}),b(l.prototype,"expandedList",[Ye],Object.getOwnPropertyDescriptor(l.prototype,"expandedList"),l.prototype),X=b(l.prototype,"search",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Z=b(l.prototype,"setSearch",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t=>{this.search=t}}}),l);var c=new We,f,ee,te,ie,ne,S,re,oe;function x(t,e,i,o){!i||Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function h(t,e,i){return e=Qe(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Qe(t){var e=Xe(t,"string");return typeof e=="symbol"?e:String(e)}function Xe(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var o=i.call(t,e||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function v(t,e,i,o,s){var r={};return Object.keys(o).forEach(function(a){r[a]=o[a]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce(function(a,d){return d(t,e,a)||a},r),s&&r.initializer!==void 0&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),r.initializer===void 0&&(Object.defineProperty(t,e,r),r=null),r}const F=window.arco.Message,Ze=window.arco.Modal,$=window.mobx.action,et=window.mobx.computed,C=window.mobx.observable,se=window._,tt=window.dayjs;let it=(f=class{constructor(){x(this,"isActive",ee,this),x(this,"setIsActive",te,this),h(this,"loading",!1),h(this,"updateIsActive",Me(async()=>{this.isActive?await m.post("/apijson/put",{Menu:{isActive:0,id:this.menu.id}}):await m.post("/apijson/put",{Menu:{isActive:1,id:this.menu.id}}),this.setIsActive(!this.isActive),F.success("\u8DEF\u7531\u72B6\u6001\u66F4\u65B0\u6210\u529F")})),h(this,"menu",void 0),h(this,"setMenu",e=>{this.menu=e,this.isActive=e.isActive==1}),x(this,"render",ie,this),x(this,"setRender",ne,this)}get updateTime(){return tt(this.updatedAt||0).format("YYYY-MM-DD HH:mm:ss")}updateData(e){se.assign(this,e),this.setRender()}},ee=v(f.prototype,"isActive",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),te=v(f.prototype,"setIsActive",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t=>{this.isActive=t}}}),ie=v(f.prototype,"render",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ne=v(f.prototype,"setRender",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return()=>{this.render=this.jsxRender?Ee(this.jsxRender):null}}}),v(f.prototype,"updateTime",[et],Object.getOwnPropertyDescriptor(f.prototype,"updateTime"),f.prototype),f),nt=(S=class{constructor(){h(this,"pages",{}),h(this,"addPage",async e=>{const i=this.pages[e.id];i.updateData(e),this.pages[e.id]=i}),h(this,"getPageList",()=>{const e=this.menus.map(i=>(i.type==="menu"&&i.pageId&&(this.pages[i.pageId]=this.pages[i.pageId]||new it,this.pages[i.pageId].setMenu(i)),i.pageId)).filter(i=>i);!e.length||m.post("/apijson/get",{"Page[]":{count:0,Page:{"id{}":e,"@column":["id","title","type","description","status","coverImage","pageTitle","userId","extraInfo","jsxRender","updatedAt"].join(",")}}}).then(async i=>{if(Array.isArray(i.Page))for(const o of i.Page){this.addPage(o);const{extraInfo:s}=o;if(s){const r=JSON.parse(s);r.components&&Array.isArray(r.components)&&await Ie.syncModuleIds(r.components),r.cssStr&&ze(r.cssStr,o.id)}}})}),x(this,"menus",re,this),x(this,"setMenus",oe,this),h(this,"getMenuList",()=>{m.post("/apijson/get",{"Menu[]":{count:0,Menu:{"@order":"sort+"}}}).then(e=>{this.setMenus(e.Menu)})}),h(this,"updateMenu",e=>{}),h(this,"createPage",async e=>{await m.post("/apijson/post",{Page:{id:e.pageId,appId:j.appId,platform:j.platform,title:e.name}})}),h(this,"saveMenu",async e=>{if(e.id){const i={Menu:{id:e.id,name:e.name,path:e.path}};return e.type==="menu"&&e.pageId&&(i.Page={id:e.pageId,title:e.name}),m.post("/apijson/put",i).then(()=>{F.success({content:"\u66F4\u65B0\u6210\u529F"}),this.getMenuList()})}return e.type==="menu"&&(e.pageId=`${j.appId}-${K("hash")}`,await this.createPage(e)),m.post("/apijson/post",{Menu:I(y({},e),{sort:Date.now()/1e3,classId:j.appId})}).then(async i=>{F.success({content:"\u65B0\u589E\u6210\u529F"}),this.getMenuList()})}),h(this,"copyNode",e=>m.post("/apijson/get",{Menu:{id:e.id},Page:{id:e.pageId}}).then(async i=>{const o=`${j.appId}-${K("hash")}`,s=`${e.name} copy`;await m.post("/apijson/post",{Page:I(y({},i.Page),{id:o})}),m.post("/apijson/post",{Menu:I(y({},se.omit(i.Menu,["id"])),{pageId:o,name:s,path:`${e.path}_copy`})}).then(()=>{F.success("\u590D\u5236\u6210\u529F"),this.getMenuList()})})),h(this,"deleteNode",e=>{if(e.children&&e.children.length)return F.warning("\u8BF7\u5148\u5220\u9664\u5F53\u524D\u76EE\u5F55\u4E0B\u63A5\u53E3\u6216\u76EE\u5F55\u7B49\u4FE1\u606F");Ze.confirm({title:`\u8BF7\u786E\u8BA4\u5220\u9664\u3010${e.name}\u3011`,onOk:()=>{let i={Menu:{id:e.id}};e.type==="menu"&&(i.Page={id:e.pageId}),m.post("/apijson/delete",i).then(o=>{F.success("\u5220\u9664\u6210\u529F"),this.getMenuList()})}})})}},re=v(S.prototype,"menus",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oe=v(S.prototype,"setMenus",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return t=>{this.menus=t,this.getPageList()}}}),S);var g=new nt;const rt=window.React.useMemo,ot=window.arco.Button,ae=window.arco.Card,ce=window.arco.Divider,st=window.arco.Dropdown,at=window.arco.Empty,z=window.arco.Menu,ue=window.arco.Space,ct=window.arco.Switch,le=window.arco.Tooltip,de=window.arco.Typography,ut=window.arcoicon.IconCodeSquare,pe=window.arcoicon.IconMore,lt=window.arcoicon.IconShareInternal,dt=window.arcoicon.IconThumbUp,pt=window._,ht=window.ReactRouterDOM.useHistory,mt=window.mobxReactLite.useObserver,he=o=>{var s=o,{item:t,notScale:e}=s,i=V(s,["item","notScale"]);const r=ht(),a=g.pages[t.pageId];return mt(()=>{const d=rt(()=>a.render?a.render:()=>n(at,{}),[a.render]),fe=u(z,{onClick:L=>{L.stopPropagation(),L.preventDefault()},children:[n(z.Item,{onClick:()=>{c.setVisible(!0,t),c.form.clearFields(),c.form.setFieldsValue(pt.pick(t,["name","type","parentId","path"]))},children:"\u7F16\u8F91\u83DC\u5355"},"menu"),n(z.Item,{onClick:()=>{window.open(`#/run${t.paths}`)},children:"\u8BBF\u95EE\u9875\u9762"},"categor"),n(z.Item,{onClick:()=>{},children:"\u9875\u9762\u65E5\u5FD7"},"api"),n(z.Item,{onClick:()=>{},children:"\u83DC\u5355\u65E5\u5FD7"},"copy")]});return u(ae,I(y({},i),{size:"small",title:u("span",{children:[t==null?void 0:t.name,n(ce,{type:"vertical"}),n(de.Text,{children:t.paths})]}),extra:u(ue,{children:[n(le,{content:"\u8BBE\u7F6E\u9875\u9762\u72B6\u6001",children:n(ct,{checked:a.isActive,size:"small",onClick:()=>{a.updateIsActive()}})}),n(le,{content:"\u9875\u9762\u5F00\u53D1",children:n(_e,{type:"primary",size:"small",icon:n(ut,{}),onClick:async()=>{r.push(`/system/pages/save?pageId=${t.pageId}`)}})}),n(st,{droplist:fe,position:"bl",trigger:"click",children:n(ot,{size:"small",icon:n(pe,{})})})]}),actions:[n("span",{className:"icon-hover",children:n(dt,{})}),n("span",{className:"icon-hover",children:n(lt,{})}),n("span",{className:"icon-hover",children:n(pe,{})})],children:[n("div",{className:p.container,children:n("div",{className:R({[p.content]:!0,[p.contentScale]:!e}),onDoubleClick:async()=>{a||await g.createPage(t),r.push(`/system/pages/save?pageId=${t.pageId}`)},children:n(xe,{children:n(d,{})})})}),n(ae.Meta,{avatar:n(ue,{children:u(de.Text,{children:[a==null?void 0:a.userId,n(ce,{type:"vertical"}),"\u66F4\u65B0\u65F6\u95F4\uFF1A",a?a.updateTime:"\u6682\u65E0"]})})})]}))})},bt=window.React.useMemo,wt=window.arco.Button,me=window.arco.Collapse,B=window.arco.Grid,ft=window._,yt=window.arcoicon.IconEdit,gt=me.Item,T=({list:t})=>{const e=bt(()=>t.length?t.map((i,o)=>i.type==="directory"?n(B.Col,{span:24,children:n(me,{bordered:!1,children:n(gt,{header:`\u76EE\u5F55\uFF1A${i.paths}\uFF08${i.name}\uFF09`,name:i.id,extra:n(wt,{type:"primary",size:"small",icon:n(yt,{}),onClick:()=>{c.setVisible(!0,i),c.form.setFieldsValue(ft.pick(i,["name","path"]))}}),children:n(T,{list:i.children})})})},o):i.type==="menu"?n(B.Col,{span:12,children:n(he,{item:i})},o):n("span",{children:"111"},o)):[],[t]);return n(B.Row,{gutter:[8,8],children:e})},vt=window.arco.Collapse;vt.Item;const It=({node:t})=>t.type==="menu"?n(he,{item:t,notScale:!0}):n("div",{children:Boolean(t.children)&&n(T,{list:t.children})}),be=window.arco.Button,_t=window.arco.ResizeBox,xt=window.arco.Input,Ft=window.arco.Form,jt=window.arco.Modal,D=window.arco.Menu,Et=window.arco.Dropdown,Mt=window.arco.Empty,zt=window.React.useEffect,A=window.React.useMemo,Dt=window.mobxReact.observer,Pt=window.mobx.toJS,St=window.arcoicon.IconCopy,$t=window.arcoicon.IconDelete,Ct=window.arcoicon.IconFile,Bt=window.arcoicon.IconFolder,Tt=window.arcoicon.IconMoreVertical,we=window.arcoicon.IconPlus,{Search:At}=xt,Lt=()=>{const[t]=Ft.useForm();c.form=t;const e=A(()=>{const s=De(Pt(g.menus));return Pe(s,(r,a)=>{const{paths:d}=a||{};return I(y({},r),{paths:`${d?`${d}/`:"/"}${r.path}`})})},[g.menus]),i=A(()=>c.search?Se(e,s=>{var a;return((a=s.name)==null?void 0:a.indexOf(c.search))!==-1||s.paths&&s.paths.indexOf(c.search)!==-1}):e,[c.search,e]),o=A(()=>$e(e,c.select),[e,c.select]);return zt(()=>{g.getMenuList()},[]),u("div",{className:R(p.pages,"page-container"),children:[u(_t,{className:p.resize,directions:["right"],children:[u("div",{className:p.listHeader,children:[n(At,{className:p.serach,value:c.search,onChange:c.setSearch,allowClear:!0,placeholder:"\u641C\u7D22\u8DEF\u7531",style:{width:"100%"}}),n(be,{type:"primary",onClick:()=>{c.setVisible(!0),t.clearFields()},children:"\u65B0\u589E"})]}),n("div",{className:p.listBody,children:n(Fe,{value:i,selectedKeys:[c.select],onSelect:(s,r)=>{c.onSelect(s)},draggable:!1,fieldNames:{key:"id",title:"name"},expandedKeys:c.expandedList,onExpand:c.setExpandedKeys,className:p.treeItem,renderTitle:s=>{const r=s.dataRef,a=u(D,{onClick:d=>{d.stopPropagation(),d.preventDefault()},children:[u(D.Item,{disabled:Boolean(s.parentId),onClick:()=>{c.setVisible(!0,{parentId:s.id,type:"directory"}),t.clearFields(),setTimeout(()=>{t.setFieldsValue(c.values)})},children:[n(we,{})," \u65B0\u589E\u76EE\u5F55"]},"categor"),u(D.Item,{disabled:r.type==="menu",onClick:()=>{t.clearFields(),c.setVisible(!0,{parentId:s.id,type:"menu"}),setTimeout(()=>{t.setFieldsValue(c.values)})},children:[n(we,{})," \u65B0\u589E\u9875\u9762"]},"api"),u(D.Item,{disabled:r.type!=="menu",onClick:()=>g.copyNode(s),children:[n(St,{})," \u590D\u5236"]},"copy"),u(D.Item,{onClick:()=>g.deleteNode(r),children:[n($t,{})," \u5220\u9664"]},"del")]});return u("div",{className:p.treeItemTitle,onDoubleClick:()=>c.saveExpandedKeys(s),children:[u("span",{children:[r.type==="directory"&&n(Bt,{}),r.type==="menu"&&n(Ct,{}),n("span",{className:p.titleText,children:s.title})]}),n(Et,{droplist:a,position:"bl",trigger:"click",children:n(be,{size:"small",icon:n(Tt,{}),onClick:d=>{d.stopPropagation(),d.preventDefault()}})})]})}})})]}),n("div",{className:p.body,children:n("div",{className:p.bodyList,children:o?n(It,{node:o}):i.length?n(T,{list:i}):n(Mt,{description:"\u6682\u65E0\u6570\u636E"})})}),n(jt,{visible:c.visible,title:`${c.values.id?"\u7F16\u8F91":"\u65B0\u589E"}\u8DEF\u7531`,style:{width:600},onCancel:()=>{c.setVisible(!1)},onOk:()=>t.validate().then(s=>g.saveMenu(y(y({},c.values),s)).then(()=>{c.setVisible(!1)})),children:n(je,{schema:c.schema,form:t,generagteProps:{cols:24}})})]})};var ei=Dt(Lt);export{ei as default};
